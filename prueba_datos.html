<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - VISTA PREVIA (DATOS SIMULADOS)</title>
    
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <div id="dashboard-content" style="display: block;">
    
        <div class="header">
            <h1>ðŸ“Š Panel de Control del Chatbot</h1>
            <button id="logout-btn">Cerrar SesiÃ³n</button>
        </div>
        
        <div id="status-bar">
            Estado: <span id="message">Vista previa de datos simulados</span>
        </div>

        <div class="card" style="border-left-color: #3498db;">
            <h3>ðŸ“ˆ MÃ©tricas Clave</h3>
            <p class="metric">Pedidos Cargados: <span id="pedidos-count" style="font-weight: bold; color: #00fff2;">0</span></p>
        </div>

        <div class="data-grid">
            
            <div class="card">
                <h3>ðŸ›’ Ãšltimos Pedidos (Detalle)</h3>
                <ul id="pedidos-list">
                    <li>Cargando pedidos simulados...</li>
                </ul>
            </div>
            
            <div class="card" style="border-left-color: #00fff2;">
                <h3>ðŸ’¬ Logs de ConversaciÃ³n Reciente (ID: Producto, Stock, AcciÃ³n)</h3>
                <ul id="conversacion-list">
                    <li>Cargando logs simulados...</li>
                </ul>
            </div>
            
        </div>
        
    </div> 

    <script>
        // ----------------------------------------------------------------------
        // 1. DATOS SIMULADOS (JSON que vendrÃ­a de Supabase)
        // ----------------------------------------------------------------------

        // A. SIMULACIÃ“N DE PEDIDOS
        // Se incluyen los campos clave: producto_nombre, estado y el numero_whatsapp (como ID Ãºnico)
        const mockPedidos = [
            {
                id: 105,
                producto_nombre: "Oud Ispahan 100ml", // Producto buscado y confirmado
                monto: 120.00,
                estado: "Pendiente", // Estado de la operaciÃ³n
                clientes: { 
                    nombre: "Andrea GarcÃ­a", 
                    numero_whatsapp: "+5491155551234" // ID ÃšNICO DEL CLIENTE
                }
            },
            {
                id: 104,
                producto_nombre: "Shaghaf Oud Aswad",
                monto: 45.00,
                estado: "Completada",
                clientes: { 
                    nombre: "Ricardo Perez", 
                    numero_whatsapp: "+5491166665678" 
                }
            },
            {
                id: 103,
                producto_nombre: "Yatagan (Cancelado por Stock)",
                monto: 70.00,
                estado: "Cancelada",
                clientes: { 
                    nombre: "Javier LÃ³pez", 
                    numero_whatsapp: "+5491177779012" 
                }
            }
        ];

        // B. SIMULACIÃ“N DE CONVERSACIÃ“N (Ejemplo de la conversaciÃ³n de Andrea GarcÃ­a)
        const mockLogs = [
            {
                es_entrada: true, // Cliente -> Bot
                contenido: "SÃ­, por favor, me envÃ­as el Oud Ispahan. Â¿CÃ³mo pago?",
                chatbot_accion: "ConfirmaciÃ³n de Compra",
                created_at: "2025-11-28T10:05:00Z"
            },
            {
                es_entrada: false, // Bot -> Cliente
                contenido: "Â¡Excelente! Confirmamos que Oud Ispahan estÃ¡ en STOCK. Â¿Deseas proceder con la compra por 120â‚¬?",
                chatbot_accion: "ConfirmaciÃ³n de Stock", // El Bot ha verificado el stock
                created_at: "2025-11-28T10:04:00Z"
            },
            {
                es_entrada: true, // Cliente -> Bot
                contenido: "Estoy buscando el perfume Oud Ispahan. Â¿Lo tienen?",
                chatbot_accion: "BÃºsqueda de Producto", // El Cliente indica el producto
                created_at: "2025-11-28T09:45:00Z"
            },
            {
                es_entrada: false, // Bot -> Cliente
                contenido: "Hola Andrea! Soy el Chatbot de Perfumes Ãrabes. Â¿En quÃ© puedo ayudarte hoy?",
                chatbot_accion: "Inicio de ConversaciÃ³n",
                created_at: "2025-11-28T09:40:00Z"
            }
        ];
        
        // ----------------------------------------------------------------------
        // 2. LÃ“GICA DE CARGA (Para renderizar los datos)
        // ----------------------------------------------------------------------

        document.addEventListener('DOMContentLoaded', () => {
            const pedidosList = document.getElementById('pedidos-list');
            const pedidosCount = document.getElementById('pedidos-count');
            const conversacionList = document.getElementById('conversacion-list');

            // --- Carga de Pedidos ---
            pedidosCount.textContent = mockPedidos.length; 
            pedidosList.innerHTML = ''; 
            
            mockPedidos.forEach(p => {
                const listItem = document.createElement('li');
                const clientName = p.clientes.nombre || `(NÃºm: ${p.clientes.numero_whatsapp})`;
                const date = new Date(p.fecha_pedido).toLocaleDateString('es-ES');
                
                // Determinamos el color del estado
                let estadoColor = 'color: #e0e0e0;'; // Gris por defecto
                if (p.estado === 'Pendiente') estadoColor = 'color: #f39c12;'; // Amarillo/Naranja
                else if (p.estado === 'Completada') estadoColor = 'color: #2ecc71;'; // Verde
                else if (p.estado === 'Cancelada') estadoColor = 'color: #e74c3c;'; // Rojo

                // NUEVA ESTRUCTURA DE PRESENTACIÃ“N DEL PEDIDO
                listItem.innerHTML = `
                    <span style="font-weight: 700; ${estadoColor}">[${p.estado}]</span> 
                    <span style="color: #c501e2; font-weight: 700;">${p.producto_nombre}</span> 
                    (${p.monto}â‚¬)<br>
                    <small>Cliente: ${clientName} - ID: ${p.clientes.numero_whatsapp} (${date})</small>
                `;
                pedidosList.appendChild(listItem);
            });

            // --- Carga de Logs ---
            conversacionList.innerHTML = '';
            mockLogs.forEach(log => {
                const direction = log.es_entrada ? 'Cliente' : 'Bot';
                const style = log.es_entrada ? 'font-weight: bold; color: #00fff2;' : 'color: #c501e2;';

                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span style="${style}">${direction}</span>: ${log.contenido.substring(0, 80)}...<br>
                    <small>AcciÃ³n: ${log.chatbot_accion || 'Mensaje'}</small>
                `;
                conversacionList.appendChild(listItem);
            });
        });

    </script>
</body>
</html>
